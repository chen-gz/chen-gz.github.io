{{- $navWidth := "hx:max-w-[90rem]" -}}
{{- with .Site.Params.navbar.width -}}
  {{ if eq . "normal" -}}
    {{ $navWidth = "hx:max-w-screen-xl" -}}
  {{ else if eq . "full" -}}
    {{ $navWidth = "max-w-full" -}}
  {{ end -}}
{{- end -}}

{{- $page := . -}}
{{- $iconHeight := 24 -}}

<div class="hextra-nav-container hx:sticky hx:top-0 hx:z-20 hx:w-full hx:bg-transparent hx:print:hidden">
  <div
    class="hextra-nav-container-blur hx:pointer-events-none hx:absolute hx:z-[-1] hx:h-full hx:w-full hx:bg-white hx:dark:bg-dark hx:shadow-[0_2px_4px_rgba(0,0,0,.02),0_1px_0_rgba(0,0,0,.06)] hx:contrast-more:shadow-[0_0_0_1px_#000] hx:dark:shadow-[0_-1px_0_rgba(255,255,255,.1)_inset] hx:contrast-more:dark:shadow-[0_0_0_1px_#fff]"
  ></div>

  <nav class="hextra-max-navbar-width hx:mx-auto hx:flex hx:items-center hx:justify-end hx:gap-2 hx:h-16 hx:px-6">
    {{ partial "navbar-title.html" . }}

    <div class="hx:flex hx:items-center hx:gap-2">
      {{- $currentPage := . -}}
      {{- range .Site.Menus.main -}}
        {{- if eq .Params.type "search" -}}
          {{- partial "search.html" (dict "params" .Params) -}}
        {{- else -}}
          {{- $link := .URL -}}
          {{- $external := strings.HasPrefix $link "http" -}}
          {{- with .PageRef -}}
            {{- if hasPrefix . "/" -}}
              {{- $link = relLangURL (strings.TrimPrefix "/" .) -}}
            {{- end -}}
          {{- end -}}

          {{- if eq .Params.type "link" -}}
            {{- partial "navbar-link.html" (dict "currentPage" $currentPage "link" $link "external" $external "item" . "icon" .Params.icon) -}}
          {{- else if .Params.icon -}}
            {{- /* Display icon menu item */ -}}
            {{- if not $link -}}{{ warnf "Icon menu item '%s' has no URL" .Name }}{{- end -}}
            <a class="hx:p-2 hx:text-current" {{ if $external }}target="_blank" rel="{{ cond (eq .Params.icon "mastodon") "noreferrer me" "noreferrer" }}"{{ end }} href="{{ $link }}" title="{{ or (T .Identifier) .Name | safeHTML }}">
              {{- partial "utils/icon.html" (dict "name" .Params.icon "attributes" (printf "height=%d" $iconHeight)) -}}
              <span class="hx:sr-only">{{ or (T .Identifier) .Name | safeHTML }}</span>
            </a>
          {{- else -}}
            {{- partial "navbar-link.html" (dict "currentPage" $currentPage "link" $link "external" $external "item" .) -}}
          {{- end -}}
        {{- end -}}
      {{- end -}}
    </div>

    <div class="hx:flex hx:items-center hx:gap-2">
      {{- if not (findRE `theme-toggle` (printf "%#v" .Site.Menus.main)) -}}
        {{- partial "theme-toggle.html" (dict "iconHeight" $iconHeight "hideLabel" true "location" "top" "class" "hx:p-2") -}}
      {{- end -}}

      {{- if and hugo.IsMultilingual (not (findRE `language-switch` (printf "%#v" .Site.Menus.main))) -}}
        <div class="hx:border-l hx:border-gray-200 hx:dark:border-neutral-800 hx:mx-2 hx:h-6"></div>
        {{- partial "language-switch" (dict "context" . "grow" false "hideLabel" true "iconName" "translate" "iconHeight" $iconHeight "location" "top" "class" "hx:p-2") -}}
      {{- end -}}
    </div>

    <button type="button" aria-label="Menu" class="hextra-hamburger-menu hx:cursor-pointer hx:-mr-2 hx:rounded-sm hx:p-2 hx:active:bg-gray-400/20 hx:md:hidden">
      {{- partial "utils/icon.html" (dict "name" "hamburger-menu" "attributes" (printf "height=%d" $iconHeight)) -}}
    </button>
  </nav>
</div>
